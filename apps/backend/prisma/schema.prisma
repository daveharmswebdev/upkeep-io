// Prisma schema file
// Documentation: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PersonType {
  OWNER
  FAMILY_MEMBER
  VENDOR
}

model User {
  id           String     @id @default(uuid())
  email        String     @unique
  passwordHash String     @map("password_hash")
  name         String
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  // Relations
  properties   Property[]
  persons      Person[]
  tenants      Tenant[]

  @@map("users")
}

model Property {
  id            String    @id @default(uuid())
  userId        String    @map("user_id")
  address       String
  city          String
  state         String    @db.VarChar(2)
  zipCode       String    @map("zip_code")
  nickname      String?
  purchaseDate  DateTime? @map("purchase_date")
  purchasePrice Decimal?  @map("purchase_price") @db.Decimal(12, 2)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // Relations
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenants       Tenant[]

  @@index([userId])
  @@map("properties")
}

model Person {
  id         String     @id @default(uuid())
  userId     String     @map("user_id")
  personType PersonType @map("person_type")
  firstName  String     @map("first_name") @db.VarChar(100)
  lastName   String     @map("last_name") @db.VarChar(100)
  middleName String?    @map("middle_name") @db.VarChar(50)
  email      String     @db.VarChar(255)
  phone      String     @db.VarChar(20)
  notes      String?    @db.Text
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime   @updatedAt @map("updated_at")

  // Relations
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenants    Tenant[]

  @@index([userId])
  @@index([personType])
  @@map("persons")
}

model Tenant {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  personId        String    @map("person_id")
  propertyId      String    @map("property_id")
  leaseStartDate  DateTime  @map("lease_start_date")
  leaseEndDate    DateTime? @map("lease_end_date")
  monthlyRent     Decimal?  @map("monthly_rent") @db.Decimal(10, 2)
  securityDeposit Decimal?  @map("security_deposit") @db.Decimal(10, 2)
  notes           String?   @db.Text
  deletedAt       DateTime? @map("deleted_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  person          Person    @relation(fields: [personId], references: [id], onDelete: Restrict)
  property        Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  pets            Pet[]

  @@index([userId])
  @@index([personId])
  @@index([propertyId])
  @@index([deletedAt])
  @@map("tenants")
}

model Pet {
  id         String   @id @default(uuid())
  tenantId   String   @map("tenant_id")
  name       String   @db.VarChar(100)
  type       String   @db.VarChar(50)
  breed      String?  @db.VarChar(100)
  weight     Decimal? @db.Decimal(6, 2)
  petDeposit Decimal? @map("pet_deposit") @db.Decimal(10, 2)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  // Relations
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@map("pets")
}
